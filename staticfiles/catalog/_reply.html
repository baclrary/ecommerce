{% load dict_filters %}

<div class="flex space-x-4 text-sm text-gray-500 mt-2 ml-{{ margin }} bg-gray-50 pr-4">
    <div class="flex-none py-2 border-l-2 border-gray-200">
        <img src="https://images.unsplash.com/photo-1502685104226-ee32379fefbe?ixlib=rb-=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=8&w=256&h=256&q=80"
             alt="" class="ml-4 h-6 w-6 rounded-full bg-gray-100">
    </div>
    <div class="py-2">
        <h4 class="font-medium text-gray-700">{{ reply.user.email }}</h4>
        <p>
            <time datetime="2021-07-16">{{ reply.created_at|date:"F j, Y" }}</time>
        </p>
        <div class="prose prose-sm mt-2 text-gray-700">
            <p>{{ reply.reply_text|linebreaks }}</p>
        </div>
        <div id="reactions" class="flex items-center mt-4">
            <button class="like-btn" data-review="{{ reply.id }}" data-model="reply">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                         class="h-4 w-4 mr-1 text-gray-500 {% if user_reactions.replies|get_item:reply.id == "like" %} text-emerald-600 {% endif %}">
                        <path d="M8 10V20M8 10L4 9.99998V20L8 20M8 10L13.1956 3.93847C13.6886 3.3633 14.4642 3.11604 15.1992 3.29977L15.2467 3.31166C16.5885 3.64711 17.1929 5.21057 16.4258 6.36135L14 9.99998H18.5604C19.8225 9.99998 20.7691 11.1546 20.5216 12.3922L19.3216 18.3922C19.1346 19.3271 18.3138 20 17.3604 20L8 20"
                              stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            <span
                  class="likes-{{ reply.id }} mr-4 text-emerald-600">{{ reply.get_reactions_counts.likes }}</span>
            <span
                  class="dislikes-{{ reply.id }} mr-2 text-pink-600">{{ reply.get_reactions_counts.dislikes }}</span>
            <button class="dislike-btn" data-review="{{ reply.id }}" data-model="reply">
                    <svg xmlns="http://www.w3.org/2000/svg" stroke="currentColor" fill="none"
                         xmlns:xlink="http://www.w3.org/1999/xlink"
                         viewBox="0 0 1000 1000"
                         class="h-3 w-3 mr-2 text-gray-500 hover:text-pink-600 {% if user_reactions.replies|get_item:reply.id == "dislike" %} text-pink-600 {% endif %}">
                        <g transform="matrix(-54.2417 0 0 -54.2417 500.0003 500.0002)" id="690888">
                            <path
                                    stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
                                    vector-effect="non-scaling-stroke"
                                    transform=" translate(-12.2806, -11.62)"
                                    d="M 8 10 V 20 M 8 10 L 4 9.99998 V 20 L 8 20 M 8 10 L 13.1956 3.93847 C 13.6886 3.3633 14.4642 3.11604 15.1992 3.29977 L 15.2467 3.31166 C 16.5885 3.64711 17.1929 5.21057 16.4258 6.36135 L 14 9.99998 H 18.5604 C 19.8225 9.99998 20.7691 11.1546 20.5216 12.3922 L 19.3216 18.3922 C 19.1346 19.3271 18.3138 20 17.3604 20 L 8 20">
                            </path>
                        </g>
                    </svg>
                </button>
            <span class="px-2 border-gray-300">|</span>

{#            <button class="reply-btn mr-3 text-indigo-600" data-user-id="{{ request.user.id }}" data-user-email="{{ request.user.email }}" data-reply-id="{{ reply.id }}" data-reply-review-id="{{ reply.review.id }}" data-parent-reply-id="{{ reply.parent_reply.id }}">Reply</button>#}
                <button class="reply-btn mr-3 text-indigo-600"
                        data-user-id="{{ request.user.id }}"
                        data-user-email="{{ request.user.email }}"
                        data-reply-id="{{ reply.id }}"
                        data-reply-review-id="{{ reply.review.id }}"
                        {% if reply.parent_reply %} data-parent-reply-id="{{ reply.parent_reply.id }}" {% endif %}>
                    Reply
                </button>

        </div>
    </div>
</div>

<!-- Sub-replies rendering -->
{% for reply_to_reply in reply.replies_to_reply.all %}
    {% with new_margin=margin|add:4 %}
        {% include "catalog/_reply.html" with reply=reply_to_reply margin=new_margin %}
    {% endwith %}
{% endfor %}
