<!--
  This example requires Tailwind CSS v2.0+ 
  
  This example requires some changes to your config:
  
  ```
  // tailwind.config.js
  module.exports = {
    // ...
    plugins: [
      // ...
      require('@tailwindcss/forms'),
      require('@tailwindcss/aspect-ratio'),
    ],
  }
  ```
-->
{% extends 'base.html' %}
{% load static %}
{% load math_filters %}
{% block content %}
    <div class="bg-white">
        <div>
            <!--
              Mobile menu

              Off-canvas menu for mobile, show/hide based on off-canvas menu state.
            -->
            <div class="relative z-40 lg:hidden" role="dialog" aria-modal="true">
                <!--
                  Off-canvas menu backdrop, show/hide based on off-canvas menu state.

                  Entering: "transition-opacity ease-linear duration-300"
                    From: "opacity-0"
                    To: "opacity-100"
                  Leaving: "transition-opacity ease-linear duration-300"
                    From: "opacity-100"
                    To: "opacity-0"
                -->
                <div class="fixed inset-0 bg-black bg-opacity-25"></div>

                <div class="fixed inset-0 z-40 flex">
                    <!--
                      Off-canvas menu, show/hide based on off-canvas menu state.

                      Entering: "transition ease-in-out duration-300 transform"
                        From: "-translate-x-full"
                        To: "translate-x-0"
                      Leaving: "transition ease-in-out duration-300 transform"
                        From: "translate-x-0"
                        To: "-translate-x-full"
                    -->
                    <div class="relative flex w-full max-w-xs flex-col overflow-y-auto bg-white pb-12 shadow-xl">
                        <div class="flex px-4 pt-5 pb-2">
                            <button type="button"
                                    class="-m-2 inline-flex items-center justify-center rounded-md p-2 text-gray-400">
                                <span class="sr-only">Close menu</span>
                                <!-- Heroicon name: outline/x-mark -->
                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                     stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>

                        <!-- Links -->
                    </div>
                </div>
            </div>

        </div>

        <div>
            <!--
              Mobile filter dialog

              Off-canvas menu for mobile, show/hide based on off-canvas menu state.
            -->
            <div class="relative z-40 lg:hidden" role="dialog" aria-modal="true">
                <!--
                  Off-canvas menu backdrop, show/hide based on off-canvas menu state.

                  Entering: "transition-opacity ease-linear duration-300"
                    From: "opacity-0"
                    To: "opacity-100"
                  Leaving: "transition-opacity ease-linear duration-300"
                    From: "opacity-100"
                    To: "opacity-0"
                -->
                <div class="fixed inset-0 bg-black bg-opacity-25"></div>

                <div class="fixed inset-0 z-40 flex">
                    <!--
                      Off-canvas menu, show/hide based on off-canvas menu state.

                      Entering: "transition ease-in-out duration-300 transform"
                        From: "translate-x-full"
                        To: "translate-x-0"
                      Leaving: "transition ease-in-out duration-300 transform"
                        From: "translate-x-0"
                        To: "translate-x-full"
                    -->
                    <div class="relative ml-auto flex h-full w-full max-w-xs flex-col overflow-y-auto bg-white py-4 pb-6 shadow-xl">
                        <div class="flex items-center justify-between px-4">
                            <h2 class="text-lg font-medium text-gray-900">Filters</h2>
                            <button type="button"
                                    class="-mr-2 flex h-10 w-10 items-center justify-center p-2 text-gray-400 hover:text-gray-500">
                                <span class="sr-only">Close menu</span>
                                <!-- Heroicon name: outline/x-mark -->
                                <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                     stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>

                        <!-- Filters -->
                        {% if products %}
                        <form class="mt-4">
                            <div class="border-t border-gray-200 pt-4 pb-4">
                                <fieldset>
                                    <legend class="w-full px-2">
                                        <!-- Expand/collapse section button -->
                                        <button type="button"
                                                class="flex w-full items-center justify-between p-2 text-gray-400 hover:text-gray-500"
                                                aria-controls="filter-section-0" aria-expanded="false">
                                            <span class="text-sm font-medium text-gray-900">Color</span>
                                            <span class="ml-6 flex h-7 items-center">
                      <!--
                        Expand/collapse icon, toggle classes based on section open state.

                        Heroicon name: mini/chevron-down

                        Open: "-rotate-180", Closed: "rotate-0"
                      -->
                      <svg class="rotate-0 h-5 w-5 transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                           fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd"
                              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                              clip-rule="evenodd"/>
                      </svg>
                    </span>
                                        </button>
                                    </legend>
                                    <div class="px-4 pt-4 pb-2" id="filter-section-0">
                                        <div class="space-y-6">
                                            <div class="flex items-center">
                                                <input id="color-0-mobile" name="color[]" value="white" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="color-0-mobile"
                                                       class="ml-3 text-sm text-gray-500">White</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="color-1-mobile" name="color[]" value="beige" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="color-1-mobile"
                                                       class="ml-3 text-sm text-gray-500">Beige</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="color-2-mobile" name="color[]" value="blue" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="color-2-mobile"
                                                       class="ml-3 text-sm text-gray-500">Blue</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="color-3-mobile" name="color[]" value="brown" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="color-3-mobile"
                                                       class="ml-3 text-sm text-gray-500">Brown</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="color-4-mobile" name="color[]" value="green" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="color-4-mobile"
                                                       class="ml-3 text-sm text-gray-500">Green</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="color-5-mobile" name="color[]" value="purple" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="color-5-mobile"
                                                       class="ml-3 text-sm text-gray-500">Purple</label>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>

                            <div class="border-t border-gray-200 pt-4 pb-4">
                                <fieldset>
                                    <legend class="w-full px-2">
                                        <!-- Expand/collapse section button -->
                                        <button type="button"
                                                class="flex w-full items-center justify-between p-2 text-gray-400 hover:text-gray-500"
                                                aria-controls="filter-section-1" aria-expanded="false">
                                            <span class="text-sm font-medium text-gray-900">Category</span>
                                            <span class="ml-6 flex h-7 items-center">
                      <!--
                        Expand/collapse icon, toggle classes based on section open state.

                        Heroicon name: mini/chevron-down

                        Open: "-rotate-180", Closed: "rotate-0"
                      -->
                      <svg class="rotate-0 h-5 w-5 transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                           fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd"
                              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                              clip-rule="evenodd"/>
                      </svg>
                    </span>
                                        </button>
                                    </legend>
                                    <div class="px-4 pt-4 pb-2" id="filter-section-1">
                                        <div class="space-y-6">
                                            <div class="flex items-center">
                                                <input id="category-0-mobile" name="category[]" value="new-arrivals"
                                                       type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="category-0-mobile" class="ml-3 text-sm text-gray-500">All
                                                    New Arrivals</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="category-1-mobile" name="category[]" value="tees"
                                                       type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="category-1-mobile"
                                                       class="ml-3 text-sm text-gray-500">Tees</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="category-2-mobile" name="category[]" value="crewnecks"
                                                       type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="category-2-mobile" class="ml-3 text-sm text-gray-500">Crewnecks</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="category-3-mobile" name="category[]" value="sweatshirts"
                                                       type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="category-3-mobile" class="ml-3 text-sm text-gray-500">Sweatshirts</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="category-4-mobile" name="category[]" value="pants-shorts"
                                                       type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="category-4-mobile" class="ml-3 text-sm text-gray-500">Pants
                                                    &amp; Shorts</label>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>

                            <div class="border-t border-gray-200 pt-4 pb-4">
                                <fieldset>
                                    <legend class="w-full px-2">
                                        <!-- Expand/collapse section button -->
                                        <button type="button"
                                                class="flex w-full items-center justify-between p-2 text-gray-400 hover:text-gray-500"
                                                aria-controls="filter-section-2" aria-expanded="false">
                                            <span class="text-sm font-medium text-gray-900">Sizes</span>
                                            <span class="ml-6 flex h-7 items-center">
                      <!--
                        Expand/collapse icon, toggle classes based on section open state.

                        Heroicon name: mini/chevron-down

                        Open: "-rotate-180", Closed: "rotate-0"
                      -->
                      <svg class="rotate-0 h-5 w-5 transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                           fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd"
                              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                              clip-rule="evenodd"/>
                      </svg>
                    </span>
                                        </button>
                                    </legend>
                                    <div class="px-4 pt-4 pb-2" id="filter-section-2">
                                        <div class="space-y-6">
                                            <div class="flex items-center">
                                                <input id="sizes-0-mobile" name="sizes[]" value="xs" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="sizes-0-mobile"
                                                       class="ml-3 text-sm text-gray-500">XS</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="sizes-1-mobile" name="sizes[]" value="s" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="sizes-1-mobile" class="ml-3 text-sm text-gray-500">S</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="sizes-2-mobile" name="sizes[]" value="m" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="sizes-2-mobile" class="ml-3 text-sm text-gray-500">M</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="sizes-3-mobile" name="sizes[]" value="l" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="sizes-3-mobile" class="ml-3 text-sm text-gray-500">L</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="sizes-4-mobile" name="sizes[]" value="xl" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="sizes-4-mobile"
                                                       class="ml-3 text-sm text-gray-500">XL</label>
                                            </div>

                                            <div class="flex items-center">
                                                <input id="sizes-5-mobile" name="sizes[]" value="2xl" type="checkbox"
                                                       class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                <label for="sizes-5-mobile"
                                                       class="ml-3 text-sm text-gray-500">2XL</label>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="border-b border-gray-200">
                <nav aria-label="Breadcrumb" class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                    <ol role="list" class="flex items-center space-x-4 py-4">
                        <li>
                            <div class="flex items-center">
                                <a href="#" class="mr-4 text-sm font-medium text-gray-900">Men</a>
                                <svg viewBox="0 0 6 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true"
                                     class="h-5 w-auto text-gray-300">
                                    <path d="M4.878 4.34H3.551L.27 16.532h1.327l3.281-12.19z" fill="currentColor"/>
                                </svg>
                            </div>
                        </li>

                        <li class="text-sm">
                            <a href="#" aria-current="page" class="font-medium text-gray-500 hover:text-gray-600">New
                                Arrivals</a>
                        </li>
                    </ol>
                </nav>
            </div>

            <main class="mx-auto max-w-2xl px-4 lg:max-w-7xl lg:px-8">
                <div class="border-b border-gray-200 pt-14 pb-10">
                    <h1 class="text-4xl font-bold tracking-tight text-gray-900">{{ sub_category.title }}</h1>
                    <p class="mt-4 text-base text-gray-500">
                        {% if sub_category.description %}{{ sub_category.description }}{% endif %}</p>
                </div>

                <div class="pt-6 pb-24 lg:grid lg:grid-cols-3 lg:gap-x-8 xl:grid-cols-4">
                    {% if products and attributes.items %}
                        <aside>
                            <h2 class="sr-only">Filters</h2>

                            <!-- Mobile filter dialog toggle, controls the 'mobileFilterDialogOpen' state. -->
                            <button type="button" class="inline-flex items-center lg:hidden">
                                <span class="text-sm font-medium text-gray-700">Filters</span>
                                <!-- Heroicon name: mini/plus -->
                                <svg class="ml-1 h-5 w-5 flex-shrink-0 text-gray-400" xmlns="http://www.w3.org/2000/svg"
                                     viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"/>
                                </svg>
                            </button>

                            <div class="hidden lg:block">
                                <form id="filterForm" method="GET" class="space-y-10 divide-y divide-gray-200">
                                    {% for category_attribute, product_values in attributes.items %}
                                        <div class="">
                                            <div class="mb-4"></div>
                                            <fieldset>
                                                <legend class="block text-sm font-medium text-gray-900">{{ category_attribute.name|upper }}</legend>
                                                <div class="space-y-3 pt-6">
                                                    {% for value in product_values %}
                                                        <div class="flex items-center">
                                                            <input id="category-{{ category_attribute.id }}"
                                                                   name="{{ category_attribute.name }}-{{ category_attribute.id }}"
                                                                   value="{{ value }}" type="checkbox"
                                                                   class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                                            <label for="category-{{ category_attribute.id }}"
                                                                   class="ml-3 text-sm text-gray-600">{{ value|title }}</label>
                                                        </div>
                                                    {% endfor %}
                                                </div>
                                            </fieldset>
                                        </div>
                                    {% endfor %}
                                </form>
                            </div>
                        </aside>
                    {% else %}
                        <p>No products here yet</p>
                    {% endif %}
                    <section aria-labelledby="product-heading" class="mt-6 lg:col-span-2 lg:mt-0 xl:col-span-3">
                        <h2 id="product-heading" class="sr-only">Products</h2>

                        <div id="content"
                             class="grid grid-cols-1 gap-y-4 sm:grid-cols-2 sm:gap-x-6 sm:gap-y-10 lg:gap-x-8 xl:grid-cols-3">
                            {% for product in products %}
                                <div class="group relative flex flex-col overflow-hidden rounded-lg border border-gray-200 bg-white">
                                    <div class="p-3 aspect-w-3 aspect-h-3 group-hover:opacity-75 sm:aspect-none sm:h-64">
                                        {% if product.image %}
                                            <img src="{{ product.image.url }}"
                                                 alt="Eight shirts arranged on table in black, olive, grey, blue, white, red, mustard, and green."
                                                 class="h-full w-full object-contain sm:h-full sm:w-full">
                                        {% else %}
                                            <img src="/media/assets/product_images/no_product.avif"
                                                 alt="Eight shirts arranged on table in black, olive, grey, blue, white, red, mustard, and green."
                                                 class="h-full w-full object-contain sm:h-full sm:w-full">
                                        {% endif %}
                                    </div>

                                    <div class="flex flex-1 flex-col space-y-1 p-3 mt-2">
                                        <h3 class="mb-2 text-sm font-medium text-gray-900">
                                            <a href="{% url "product-detail-view" sub_category.category.slug sub_category.slug product.id %}">
                                                <span aria-hidden="true" class="absolute inset-0"></span>
                                                {{ product|truncatechars:100 }}
                                            </a>
                                        </h3>
                                        <p class="text-sm text-gray-500">{{ product.description|truncatechars:155 }}</p>
                                        <div class="flex flex-1 flex-col justify-end">
                                            <div class="mt-2 mb-2 flex items-center">
                                                {% if not product.reviews.all %}
                                                    <p class="text-sm italic text-gray-500">No reviews yet</p>
                                                {% else %}
                                                    {% for i in product.get_product_rating|round_half|full_stars %}
                                                        <svg class="text-yellow-400 h-5 w-5 flex-shrink-0"
                                                             xmlns="http://www.w3.org/2000/svg"
                                                             viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                                            <path fill-rule="evenodd"
                                                                  d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401z"
                                                                  clip-rule="evenodd"/>
                                                        </svg>
                                                    {% endfor %}
                                                    {% if product.get_product_rating|round_half|half_star %}
                                                        <!-- Half star SVG -->
                                                        <div class="h-5 w-2.5 overflow-hidden">
                                                            <svg class="text-yellow-400 h-5 w-5 flex-shrink-0"
                                                                 xmlns="http://www.w3.org/2000/svg"
                                                                 viewBox="0 0 20 20" fill="currentColor"
                                                                 aria-hidden="true">
                                                                <path fill-rule="evenodd"
                                                                      d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401z"
                                                                      clip-rule="evenodd"/>
                                                            </svg>
                                                        </div>
                                                    {% endif %}
                                                    <p class="ml-2 prose prose-sm text-gray-500 text-sm text-gray-500">
                                                        {{ product.get_product_rating|floatformat }}</p>
                                                {% endif %}
                                            </div>


                                            <p class="text-base font-medium text-gray-900">
                                                â‚´ {{ product.price|floatformat }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                            <!-- More products... -->
                        </div>
                    </section>
                </div>
            </main>

        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    {# Filtering script #}
    <script>
        $(document).ready(function () {
            $('#filterForm input[type=checkbox]').on('change', function (e) {
                e.preventDefault(); // prevent the default form submission
                $.ajax({
                    url: window.location.pathname, // or you can use URL of your View
                    data: $('#filterForm').serialize(), // form data
                    success: function (data) {
                        $('#content').html($(data).find('#content').html());
                    }
                });
            });
        });
    </script>
{% endblock content %}
